<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drawing Viewer</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        #image-container {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.7);
            padding: 10px;
            border-radius: 5px;
            max-width: 30%;
            max-height: 30%;
        }
        #image-display {
            width: 100%;
            height: auto;
            display: block;
        }
    </style>
</head>
<body>
    <div id="controls">
        <input type="file" id="file-input" accept=".json">
        <button id="load-btn">Load Drawing</button>
        <button id="show-image-btn">Show as Image</button>
        <div id="stats"></div>
    </div>
    
    <div id="image-container" style="display: none;">
        <img id="image-display">
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="api.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        const camera = new THREE.OrthographicCamera(
            window.innerWidth / -2, window.innerWidth / 2,
            window.innerHeight / 2, window.innerHeight / -2,
            0.1, 1000
        );
        camera.position.z = 5;

        // Renderer setup
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Handle window resize
        window.addEventListener('resize', () => {
            const width = window.innerWidth;
            const height = window.innerHeight;
            
            camera.left = width / -2;
            camera.right = width / 2;
            camera.top = height / 2;
            camera.bottom = height / -2;
            camera.updateProjectionMatrix();
            
            renderer.setSize(width, height);
            render();
        });

        // Initialize the API
        const drawingAPI = new DrawingAPI();
        let currentLines = [];

        // Clear the scene of current lines
        function clearScene() {
            currentLines.forEach(line => {
                scene.remove(line);
                line.geometry.dispose();
                line.material.dispose();
            });
            currentLines = [];
            render();
        }

        // Load drawing from file
        async function loadDrawingFromFile() {
            const fileInput = document.getElementById('file-input');
            if (!fileInput.files.length) {
                alert('Please select a file first');
                return;
            }

            try {
                clearScene();
                await drawingAPI.loadDrawingFromFile(fileInput.files[0]);
                
                // Render to scene
                currentLines = drawingAPI.renderToScene(scene);
                
                // Update stats
                updateStats();
                
                // Render the scene
                render();
            } catch (error) {
                console.error('Error loading drawing:', error);
                alert('Failed to load drawing file');
            }
        }

        // Show drawing as image
        function showAsImage() {
            if (!drawingAPI.drawingData) {
                alert('No drawing loaded');
                return;
            }
            
            const canvas = drawingAPI.toBitmap();
            if (!canvas) {
                alert('Failed to create image');
                return;
            }
            
            // Convert canvas to image URL
            const imageUrl = canvas.toDataURL('image/png');
            
            // Display the image
            const imgContainer = document.getElementById('image-container');
            const imgDisplay = document.getElementById('image-display');
            
            imgDisplay.src = imageUrl;
            imgContainer.style.display = 'block';
        }

        // Update stats display
        function updateStats() {
            if (!drawingAPI.drawingData) return;
            
            const strokes = drawingAPI.getStrokes();
            let totalPoints = 0;
            strokes.forEach(stroke => {
                totalPoints += stroke.points.length;
            });
            
            document.getElementById('stats').innerHTML = `
                <p>Strokes: ${strokes.length}</p>
                <p>Total Points: ${totalPoints}</p>
            `;
        }

        // Event listeners
        document.getElementById('load-btn').addEventListener('click', loadDrawingFromFile);
        document.getElementById('show-image-btn').addEventListener('click', showAsImage);

        // Animation loop
        function render() {
            renderer.render(scene, camera);
        }

        // Start rendering
        render();
    </script>
</body>
</html> 